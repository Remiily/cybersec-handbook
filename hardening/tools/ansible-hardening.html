<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansible para Hardening - Cybersec Handbook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="../../assets/css/main.css">
</head>
<body class="bg-white dark:bg-slate-900 text-gray-900 dark:text-gray-100">
    <div id="sidebar-overlay" class="sidebar-overlay" onclick="closeSidebar()"></div>
    <aside id="sidebar" class="sidebar fixed top-0 left-0 h-full w-64 bg-white dark:bg-slate-800 border-r border-gray-200 dark:border-gray-700 z-50 overflow-y-auto">
        <div class="p-4">
            <a href="../../" class="text-xl font-bold text-blue-600 dark:text-blue-400 block mb-6">üîí Cybersec Handbook</a>
            <nav>
                <a href="../" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">‚Üê Volver a Hardening</a>
            </nav>
        </div>
    </aside>
    
    <div class="lg:ml-64">
        <header class="sticky top-0 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between px-4 py-3">
                <button id="sidebar-toggle" onclick="toggleSidebar()" class="lg:hidden mr-3 text-gray-500"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button>
                <div id="breadcrumbs" class="breadcrumb"></div>
                <button id="theme-toggle" onclick="toggleTheme()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path></svg></button>
            </div>
        </header>
        
        <main class="p-6 max-w-5xl mx-auto">
            <article>
                <header class="mb-8">
                    <h1 class="text-4xl font-bold mb-4">Automatizaci√≥n de Hardening con Ansible</h1>
                    <p class="text-xl text-gray-600 dark:text-gray-400 mb-4">
                        Automatiza el hardening de sistemas usando Ansible para consistencia y escalabilidad
                    </p>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span class="badge badge-intermediate">Intermedio</span>
                        <span class="text-sm text-gray-500">‚è±Ô∏è 2 horas</span>
                    </div>
                </header>
                
                <div id="table-of-contents" class="toc">
                    <h3 class="font-semibold mb-3">Tabla de Contenidos</h3>
                </div>
                
                <section class="mb-8">
                    <h2 id="introduccion-ansible" class="text-2xl font-semibold mb-4">¬øPor qu√© usar Ansible para Hardening?</h2>
                    <p class="mb-4">
                        <strong>Ansible</strong> es una herramienta de automatizaci√≥n que permite definir configuraciones como c√≥digo. 
                        Para hardening, ofrece varios beneficios:
                    </p>
                    <ul class="list-disc list-inside space-y-2 mb-4">
                        <li><strong>Consistencia:</strong> Mismas configuraciones en todos los sistemas</li>
                        <li><strong>Reproducibilidad:</strong> Puedes recrear configuraciones exactas</li>
                        <li><strong>Escalabilidad:</strong> Aplicar hardening a cientos de sistemas simult√°neamente</li>
                        <li><strong>Versionado:</strong> Controlar cambios con Git</li>
                        <li><strong>Documentaci√≥n:</strong> El c√≥digo es documentaci√≥n</li>
                        <li><strong>Idempotencia:</strong> Ejecutar m√∫ltiples veces sin efectos secundarios</li>
                    </ul>
                </section>
                
                <section class="mb-8">
                    <h2 id="instalacion-ansible" class="text-2xl font-semibold mb-4">Instalaci√≥n de Ansible</h2>
                    
                    <h3 class="text-xl font-semibold mb-3">Linux/Mac (Control Node)</h3>
                    <div class="command-block">
                        <pre><code># Ubuntu/Debian
sudo apt update
sudo apt install ansible -y

# RHEL/CentOS
sudo yum install ansible -y

# macOS (con Homebrew)
brew install ansible

# Verificar instalaci√≥n
ansible --version</code></pre>
                    </div>
                    
                    <h3 class="text-xl font-semibold mb-3 mt-4">Instalaci√≥n desde pip (m√°s reciente)</h3>
                    <div class="command-block">
                        <pre><code># Instalar pip si no est√° instalado
sudo apt install python3-pip -y

# Instalar Ansible
pip3 install ansible

# O instalar en virtual environment (recomendado)
python3 -m venv ansible-env
source ansible-env/bin/activate
pip install ansible</code></pre>
                    </div>
                </section>
                
                <section class="mb-8">
                    <h2 id="estructura-proyecto" class="text-2xl font-semibold mb-4">Estructura de un Proyecto Ansible</h2>
                    <p class="mb-4">
                        Organiza tu proyecto de hardening con esta estructura:
                    </p>
                    <div class="command-block">
                        <pre><code>ansible-hardening/
‚îú‚îÄ‚îÄ inventory/
‚îÇ   ‚îú‚îÄ‚îÄ hosts.yml          # Inventario de hosts
‚îÇ   ‚îî‚îÄ‚îÄ group_vars/
‚îÇ       ‚îî‚îÄ‚îÄ all.yml        # Variables globales
‚îú‚îÄ‚îÄ playbooks/
‚îÇ   ‚îú‚îÄ‚îÄ hardening.yml      # Playbook principal
‚îÇ   ‚îî‚îÄ‚îÄ hardening-linux.yml
‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks/main.yml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vars/main.yml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ ssh/
‚îÇ   ‚îî‚îÄ‚îÄ firewall/
‚îú‚îÄ‚îÄ ansible.cfg            # Configuraci√≥n de Ansible
‚îî‚îÄ‚îÄ requirements.yml       # Dependencias (roles externos)</code></pre>
                    </div>
                </section>
                
                <section class="mb-8">
                    <h2 id="playbook-basico" class="text-2xl font-semibold mb-4">Playbook B√°sico de Hardening</h2>
                    <p class="mb-4">
                        Ejemplo de playbook b√°sico para hardening Linux:
                    </p>
                    <div class="command-block">
                        <pre><code>---
# playbooks/hardening-linux.yml
- name: System Hardening Playbook
  hosts: all
  become: yes
  vars:
    firewall_allowed_ports:
      - { port: "22", proto: "tcp", name: "SSH" }
      - { port: "80", proto: "tcp", name: "HTTP" }
      - { port: "443", proto: "tcp", name: "HTTPS" }
    
    disable_root_ssh: true
    require_ssh_key: true
  
  tasks:
    - name: Update system packages
      package:
        name: "*"
        state: latest
      when: ansible_os_family == "Debian"
    
    - name: Install UFW
      package:
        name: ufw
        state: present
      when: ansible_os_family == "Debian"
    
    - name: Configure UFW default policies
      ufw:
        state: enabled
        policy: "{{ item.policy }}"
        direction: "{{ item.direction }}"
      loop:
        - { policy: "deny", direction: "incoming" }
        - { policy: "allow", direction: "outgoing" }
    
    - name: Allow specific ports in UFW
      ufw:
        rule: allow
        port: "{{ item.port }}"
        proto: "{{ item.proto }}"
      loop: "{{ firewall_allowed_ports }}"
    
    - name: Disable root login in SSH
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: "^PermitRootLogin"
        line: "PermitRootLogin no"
        backup: yes
        notify: restart sshd
      when: disable_root_ssh
    
    - name: Disable password authentication in SSH
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: "^PasswordAuthentication"
        line: "PasswordAuthentication no"
        backup: yes
        notify: restart sshd
      when: require_ssh_key
  
  handlers:
    - name: restart sshd
      systemd:
        name: sshd
        state: restarted</code></pre>
                    </div>
                </section>
                
                <section class="mb-8">
                    <h2 id="roles-ansible" class="text-2xl font-semibold mb-4">Usando Roles de Hardening</h2>
                    <p class="mb-4">
                        Roles reutilizables hacen el c√≥digo m√°s modular. Ejemplo de estructura de role:
                    </p>
                    
                    <h3 class="text-xl font-semibold mb-3">Estructura de un Role</h3>
                    <div class="command-block">
                        <pre><code>roles/ssh/
‚îú‚îÄ‚îÄ tasks/
‚îÇ   ‚îî‚îÄ‚îÄ main.yml          # Tareas principales
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ main.yml          # Handlers (ej: restart sshd)
‚îú‚îÄ‚îÄ vars/
‚îÇ   ‚îî‚îÄ‚îÄ main.yml          # Variables del role
‚îú‚îÄ‚îÄ defaults/
‚îÇ   ‚îî‚îÄ‚îÄ main.yml          # Valores por defecto
‚îî‚îÄ‚îÄ templates/
    ‚îî‚îÄ‚îÄ sshd_config.j2    # Templates Jinja2</code></pre>
                    </div>
                    
                    <h3 class="text-xl font-semibold mb-3 mt-4">Ejemplo de Role: SSH Hardening</h3>
                    <div class="command-block">
                        <pre><code># roles/ssh/tasks/main.yml
---
- name: Backup SSH configuration
  copy:
    src: /etc/ssh/sshd_config
    dest: /etc/ssh/sshd_config.backup
    remote_src: yes
  
- name: Configure SSH daemon
  template:
    src: sshd_config.j2
    dest: /etc/ssh/sshd_config
    owner: root
    group: root
    mode: '0644'
    backup: yes
  notify: restart sshd
  
- name: Ensure SSH service is running
  systemd:
    name: sshd
    state: started
    enabled: yes</code></pre>
                    </div>
                </section>
                
                <section class="mb-8">
                    <h2 id="roles-externos" class="text-2xl font-semibold mb-4">Roles Externos Recomendados</h2>
                    <p class="mb-4">
                        No reinventes la rueda. Usa roles probados de la comunidad:
                    </p>
                    
                    <div class="card mb-4">
                        <div class="card-header">dev-sec/ansible-hardening</div>
                        <p class="text-sm mb-2">
                            Role completo de hardening para Linux basado en benchmarks CIS y otros est√°ndares.
                        </p>
                        <div class="command-block">
                            <pre><code># requirements.yml
---
roles:
  - name: dev-sec.ansible-hardening
    version: "7.9.0"

# Instalar
ansible-galaxy install -r requirements.yml

# Usar en playbook
- hosts: all
  roles:
    - dev-sec.ansible-hardening</code></pre>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-header">geerlingguy/ansible-role-security</div>
                        <p class="text-sm mb-2">
                            Role de seguridad b√°sica de Jeff Geerling.
                        </p>
                    </div>
                </section>
                
                <section class="mb-8">
                    <h2 id="ejecutar-playbook" class="text-2xl font-semibold mb-4">Ejecutar Playbooks</h2>
                    <p class="mb-4">
                        Comandos esenciales para ejecutar playbooks:
                    </p>
                    <div class="command-block">
                        <pre><code># Verificar conectividad con hosts
ansible all -m ping

# Ejecutar playbook (dry-run, sin hacer cambios)
ansible-playbook playbooks/hardening.yml --check --diff

# Ejecutar playbook en un host espec√≠fico
ansible-playbook playbooks/hardening.yml --limit webserver1

# Ejecutar con tags espec√≠ficos
ansible-playbook playbooks/hardening.yml --tags "firewall,ssh"

# Ejecutar con verbosidad aumentada (debug)
ansible-playbook playbooks/hardening.yml -vvv

# Ejecutar con l√≠mite de hosts concurrentes
ansible-playbook playbooks/hardening.yml --forks 10</code></pre>
                    </div>
                </section>
                
                <section class="mb-8">
                    <h2 id="mejores-practicas" class="text-2xl font-semibold mb-4">Mejores Pr√°cticas</h2>
                    <ul class="list-disc list-inside space-y-2 mb-4">
                        <li><strong>Usar variables:</strong> No hardcodear valores, usar variables para flexibilidad</li>
                        <li><strong>Idempotencia:</strong> Aseg√∫rate de que tus tareas sean idempotentes</li>
                        <li><strong>Handlers:</strong> Usa handlers para servicios que necesitan reinicio</li>
                        <li><strong>Tags:</strong> Organiza tareas con tags para ejecuci√≥n selectiva</li>
                        <li><strong>Testing:</strong> Prueba playbooks en entornos de desarrollo primero</li>
                        <li><strong>Versionado:</strong> Usa Git para versionar tus playbooks</li>
                        <li><strong>Documentaci√≥n:</strong> Documenta variables y prop√≥sito de cada role</li>
                        <li><strong>Backups:</strong> Siempre haz backup antes de aplicar cambios cr√≠ticos</li>
                    </ul>
                </section>
                
                <section class="mb-8">
                    <h2 id="referencias" class="text-2xl font-semibold mb-4">Referencias</h2>
                    <ul class="list-disc list-inside space-y-2">
                        <li><a href="https://docs.ansible.com/" class="text-blue-600 dark:text-blue-400 hover:underline" target="_blank">Ansible Documentation</a></li>
                        <li><a href="https://galaxy.ansible.com/" class="text-blue-600 dark:text-blue-400 hover:underline" target="_blank">Ansible Galaxy</a></li>
                        <li><a href="https://github.com/dev-sec/ansible-hardening" class="text-blue-600 dark:text-blue-400 hover:underline" target="_blank">dev-sec/ansible-hardening (GitHub)</a></li>
                    </ul>
                </section>
            </article>
        </main>
        
        <footer class="border-t border-gray-200 dark:border-gray-700 mt-12 py-8">
            <div class="max-w-5xl mx-auto px-6">
                <p class="text-sm text-gray-600 dark:text-gray-400 text-center">
                    √öltima actualizaci√≥n: 2025-01-XX | 
                    <a href="https://github.com/Remiily/cybersec-handbook" class="text-blue-600 dark:text-blue-400 hover:underline">Editar en GitHub</a>
                </p>
            </div>
        </footer>
    </div>
    
    <script src="../../assets/js/main.js"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
</body>
</html>
